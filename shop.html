<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ZHORDE Shop</title>
  <style>
    body { background: #191941; color: #fff; font-family: Arial, sans-serif; }
    #shop-container { margin: 60px auto; max-width: 600px; background: #222255; border-radius: 16px; padding: 40px; box-shadow: 0 6px 40px #000a; }
    h1 { color: #ffd700; margin-bottom: 30px; }
    .label { color: #aee8ff; }
    .rank { color: #ffd700; font-weight: bold; }
    #info { margin-bottom: 40px; }
    .item { margin: 18px 0 12px 0; padding: 14px 14px 14px 22px; border-radius: 10px; background: #2a2a5c; }
    .item button { float:right; background: #ffd700; color:#222255; border: none; border-radius: 6px; padding: 6px 18px; font-weight: bold; cursor:pointer; }
    .item .desc { color: #aee8ff; display:block; margin-top:6px;}
    .success { color: #0f0; margin-top: 18px; }
    .error { color: #ff5050; margin-top: 18px; }
    #export-inv { margin-top: 40px; background: #aee8ff; color:#222255; border-radius:6px; font-weight:bold; padding: 8px 26px; border:none; cursor:pointer;}
    #export-inv[disabled] {background: #888; color:#ccc; cursor:default;}
    #export-area { margin-top: 16px; width:100%; min-height:40px; }
  </style>
</head>
<body>
  <div id="shop-container">
    <h1>ZHORDE Shop</h1>
    <div id="info">
      <span class="label">Coins:</span> <span id="coins">0</span><br>
      <span class="label">Ranking:</span> <span id="ranking" class="rank">Unranked</span><br>
      <span class="label">XP:</span> <span id="xp">0</span><br>
      <span class="label">Level:</span> <span id="level">0</span>
    </div>
    <hr>
    <div>
      <b>Welcome to the shop! Spend your coins on powerups and cosmetics.</b>
      <div class="item" data-name="Mega Health" data-desc="Gain +50 HP (use in inventory)" data-type="powerup" data-id="mega_health" data-price="40">
        <b>Mega Health (+50 HP)</b> - <span class="label">40 coins</span>
        <span class="desc">Gain +50 HP as an inventory item. Use it anytime in-game.</span>
        <button onclick="buyItem(this)">Buy</button>
      </div>
      <div class="item" data-name="Nuke Bomb" data-desc="Kill all zombies instantly (one use)" data-type="powerup" data-id="nuke_bomb" data-price="100">
        <b>Nuke Bomb</b> - <span class="label">100 coins</span>
        <span class="desc">Wipe out all zombies on screen. Use it when you need to panic!</span>
        <button onclick="buyItem(this)">Buy</button>
      </div>
      <div class="item" data-name="Freeze All" data-desc="Freeze all zombies for 5 seconds" data-type="powerup" data-id="freeze_all" data-price="55">
        <b>Freeze All</b> - <span class="label">55 coins</span>
        <span class="desc">Temporarily freeze all zombies for 5 seconds. Use from inventory.</span>
        <button onclick="buyItem(this)">Buy</button>
      </div>
      <div class="item" data-name="Golden Skin" data-desc="Unlock golden player skin (cosmetic)" data-type="cosmetic" data-id="golden_skin" data-price="75">
        <b>Golden Skin</b> - <span class="label">75 coins</span>
        <span class="desc">Change your in-game player color to GOLD! (Cosmetic)</span>
        <button onclick="buyItem(this)">Buy</button>
      </div>
      <div class="item" data-name="XP Doubler" data-desc="Double XP for 3 waves" data-type="powerup" data-id="xp_doubler" data-price="60">
        <b>XP Doubler (3 Waves)</b> - <span class="label">60 coins</span>
        <span class="desc">Doubles all XP for the next 3 waves. Use from inventory.</span>
        <button onclick="buyItem(this)">Buy</button>
      </div>
      <div class="item" data-name="Random Gift" data-desc="Random surprise item" data-type="mystery" data-id="random_gift" data-price="35">
        <b>Random Gift</b> - <span class="label">35 coins</span>
        <span class="desc">Who knows what you'll get? Use in-game to find out!</span>
        <button onclick="buyItem(this)">Buy</button>
      </div>
    </div>
    <div id="shop-message"></div>
    <hr>
    <button id="export-inv" onclick="exportInventory()">Export Purchases for Import</button>
    <textarea id="export-area" readonly placeholder="Your purchased items export will appear here. Copy & paste into the game!"></textarea>
    <div style="margin-top:18px;color:#aaa;">Paste the export string into your game's import menu or inventory to use your items!</div>
  </div>
  <script>
    // Read query params for coins and ranking
    function updateStatsFromParams() {
      const params = new URLSearchParams(window.location.search);
      // Parse coins
      let playerCoins = parseInt(params.get("coins") || "0");
      document.getElementById("coins").textContent = playerCoins;
      // Compose ranking string from rankName, rankXP, rankLevel if present
      let rankName = params.get("rankName");
      let rankXP = params.get("rankXP");
      let rankLevel = params.get("rankLevel");
      let ranking = "Unranked";
      if(rankName && rankName !== "null"){
        ranking = rankName;
        if(rankLevel && rankLevel !== "null") ranking += " (Lv." + rankLevel + ")";
        if(rankXP && rankXP !== "null") ranking += " | XP: " + rankXP;
      }
      document.getElementById("ranking").textContent = ranking;
      document.getElementById("xp").textContent = (rankXP && rankXP !== "null") ? rankXP : "0";
      document.getElementById("level").textContent = (rankLevel && rankLevel !== "null") ? rankLevel : "0";
      // Update player's coins in buyItem scope
      window._playerCoins = playerCoins;
    }
    updateStatsFromParams();

    // Inventory to be exported (list of bought items)
    let purchasedInventory = [];

    function buyItem(btn) {
      const div = btn.closest('.item');
      const name = div.getAttribute('data-name');
      const desc = div.getAttribute('data-desc');
      const type = div.getAttribute('data-type');
      const id = div.getAttribute('data-id');
      const price = parseInt(div.getAttribute('data-price'));
      const messageDiv = document.getElementById("shop-message");
      messageDiv.textContent = "";

      // Use global _playerCoins for up-to-date coins
      if (window._playerCoins === undefined) window._playerCoins = parseInt(document.getElementById("coins").textContent || "0");

      // Check coins
      if (window._playerCoins < price) {
        messageDiv.textContent = "Not enough coins!";
        messageDiv.className = "error";
        return;
      }

      // Add to inventory
      purchasedInventory.push({
        name: name,
        desc: desc,
        type: type,
        id: id
      });

      // Deduct coins and update UI
      window._playerCoins -= price;
      document.getElementById("coins").textContent = window._playerCoins;
      messageDiv.textContent = `Purchased: ${name}!`;
      messageDiv.className = "success";
    }

    function exportInventory() {
      const exportArea = document.getElementById("export-area");
      if (purchasedInventory.length === 0) {
        exportArea.value = "No items purchased.";
        return;
      }
      // Export as a JSON string (easy to import into Python)
      exportArea.value = JSON.stringify(purchasedInventory);
    }

    // Live update if user re-opens with different stats/coins
    window.addEventListener("focus", function() {
      updateStatsFromParams();
    });

    // Optionally, poll every second for new URL (for some browsers that do not refresh on focus)
    setInterval(updateStatsFromParams, 1000);
  </script>
</body>
</html>
